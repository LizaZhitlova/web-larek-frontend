# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Об архитектуре  приложения 
Архитектура приложения построена на событийно-ориентированном подходе.
Взаимодействие между компонентами приложения осуществляется с помощью событий через EventEmitter. Модели генерируют события, 
а их обработчики в основном коде отвечают за передачу данных в компоненты отображения, выполняют промежуточные вычисления и обновляют значения в моделях.
Компоненты приложени:
Модели: BasketModel, OrderModel, CatalogModel - хранят данные и управляют ими.
Представление:BasketView, ContactsView, PreviewView, OrderView, SuccessView — UI-компоненты, которые отвечают за отображение интерфеса приложения.
Окружение: Api, EventEmitter, константы.

## Данне и типы данных используемые в приложении

IProduct - интерфейс, хранит типы данных карточки товара
export interface IProduct {
id: string;
title: string;
description: string;
image: string;
category: string;
price: number | null;
}

IProductListResponse - интерфес хранит типы данных, которые выводятся на страницу.
export interface IProductListResponse {
total: number;
items: IProduct[];
}

IOrderRequest - интерфейс хранит типы пользовательских данных
export interface IOrderRequest {
payment: 'online' | 'cash';
email: string;
phone: string;
address: string;
total: number;
items: string[];
}

IOrderSuccessResponse - хранит типы данных используемые в модальном успешного оформления заказа
export interface IOrderSuccessResponse {
id: string;
total: number;
}
IErrorResponse - хранит типы данных ошибки при оформлении заказа
export interface IErrorResponse {
error: string;
}

### Базовый код

## Класс IEventEmitter

-брокер событий и позволяет подписываться на события и уведомлять подписчиков о наступлении события. Класс имеет методы on , off , emit — для подписки на событие,отписки от события и уведомления подписчиков о наступлении события соответственно. Дополнительно реализованы методы onAll и offAll — для подписки на все события и сброса всех подписчиков.Так же добавлен метод trigger , генерирующий заданное событие с заданными аргументами. Это позволяет передавать его в качестве обработчика события в другие классы. Эти классы будут генерировать события, не будучи при этом напрямую зависимыми от класса EventEmitter.


## Класс Api

- реализует интерфейс для работы с HTTP запросами.Класс содержит методы get (получение данных с сервера )и post для отправки данных (отправка данных на сервер), и защищенный метод handleResponse для обработки ответов.Успешные ответы сервера преобразовываются в JSON, ошибочные отклоняются с сообщением об ошибке.Используется как родительский класс для API-клиентов.

Конструктор класса:
constructor(baseUrl: string, options: RequestInit = {})
Принимает агрументами 
baseUrl -базовый URL сервера. Типа - сторка.
options -Объект конфигурации fetch-запросов.Тип-RequestInit.

Конструктор устанавливает базовый URL для запросов и инициализирует заголовки.

Метода класса:

 protected handleResponse(response: Response): Promise<object>- защищённый метод. Обрабатывает ответ от сервера.Возвращает response.json(), если запрос прошёл успешно, либо отклоняетс сообщением об ошибке.
Принимает агрумент response — объект Response, т.е. ответ сервера.
Возвращает Promise<object>- результат - JSON.

get(uri: string) - выполняет GET-запрос по указанному пути.
Принимает агрумент uri - относительный путь к ресурсу. Тип строка.
Возвращает результат выполения запроса.

post(uri: string, data: object, method: ApiPostMethods = 'POST') - dыполняет POST-запрос и передаёт JSON-данные.
Аргументы:
uri: string — относительный путь запроса.Тип- сторока.
data: object — тело запроса. Объект Json.
method: ApiPostMethods — HTTP-метод типа ApiPostMethods.По умолчанию РОST.
Возвращает результат выполения запроса.

### Модель данных(бизнес логика)

## Класс BasketModel

- управляет состоянием корзины и оповещает другие части приложения об изменениях. Реализует:добавление товаров, удаление товаров из корзины, очистку корзины и уведомление подписчиков об изменениях в корзине.

Конструрктор класса:
constructor(protected events: IEventEmitter) {}
Принимает единственный аргумент protected events: IEventEmitter - защищённое поле - объект, реализующий интерфейс IEventEmitter. Необходим для уведомления об изменениях в корзине.
Конструктор  принимает внешний объект events и тем самым обеспечивает слабую связанность.
Подключение будет происходить в главном коде при создании экземпляра класса(например, const basketModel = new BasketModel(events)).

Поле класса:
items: Map<string, number> - поле items хранит товары корзины в виде коллекции пар индентификатор товара(id)- количество товра.

Методы класса:

add(id: string): void - Добавляет товар в корзину. Принимает в качестве аргумента идентификатор товара.

Если товар уже есть корзине,то увеличивает его количество на 1.
Если же товара нет, то добавляет его в количестве 1.
После изменения в корзине вызывается событие событие 'basket:change'.

remove(id: string): void - Уменьшает количество товара или удаляет его из корзины.Принимает в качестве аргумента идентификатор товара.

Если товара нет, то никакиз действий не совершается.
Если количество > 1, уменьшает на 1.
Если количество = 1 — удаляет товар из корзины.
После изменения в корзине вызывается событие событие 'basket:change'.

clear(): void - Полная очистка корзины.

Удаление всех товаров.
После изменения в корзине вызывается событие событие 'basket:change'.

protected \_changed(): void - Внутренний метод, который оповещает об изменениях.
Генерирует событие 'basket:change' с текущим списком товаров (Array.from(this.items.keys())).

## Класс CatalogModel

- модель данных каталого товаров.Отвечает за харнение списка товаров, управление состояние каталога (инициализация и обновление списка товаров),
  поиск товара в каталоге по идентификатору.

Конструрктор класса:
constructor(protected events: IEventEmitter) {}
Принимает единственный аргумент protected events: IEventEmitter - защищённое поле - объект, реализующий интерфейс IEventEmitter. Необходим для уведомления об изменениях в корзине.
Конструктор  принимает внешний объект events и тем самым обеспечивает слабую связанность.
Подключение будет происходить в главном коде при создании экземпляра класса(например, const basketModel = new BasketModel(events)).

Поля класса:
items: IProduct[]- поле items представляет собой массив объектов товаров.Инициализируется пустым массивом.

Методы класса:

setItems(items: IProduct[]) - отвечает за обновлнение данных каталога. В качестве агрумент приниамет новый массив товаров для замены текущего.
Полностью заменяет текущий this.items на новый массив.
Генерирует событие 'catalog:loaded' с новым списком товаров.

getProduct(id: string) - отвечает за поиск конкретного товара в каталоге по уникальному идентификатору. В качестве аргумента принимает идентификатор товара-строка.
Осуществляет поиск по массиву.
После чего возвращает первый найденный IProduct с соотвествующем id или undefined если товар не найден.

## Класс OrderModel

- модель данных заказа. Отвечает за хранение данных о заказе(адрес, номер телефона, способ оплаты, список товаров), управляет состояением заказа (расчёто итоговой стоимости), преобразование данных о заказе для отправки на севрер.

Конструктор класса:
constructor(private getProduct: (id: string) => IProduct | undefined) - принимает и сохраняет приватный метод, который отвечает за поиск конкретного товара в каталоге по уникальному идентификатору.
Агрументы:
getProduct: (id: string) => IProduct | undefined -  внешняя функция, которая по переданному id возвращает объект товара типа IProduct или undefined, если товар не найден.
Подключение будет происходить в главном коде при создании экземпляра класса.

Поля класса:

payment: 'online' | 'cash' | null = null - способ оплаты( по умолчанию не выбран =null);
address = '' - адрес доставки (строка);
email = ''- эелектронная почта пользователя (строчка);
phone = '' - номер телефона пользователя (строчка);
items: string[] - массив идентификаторов товара (массив строчек).

Методы класса:

setField(field: keyof IOrderModel, value: any) - отвечает за обновление поля заказа.В качестве агрументов принимает строго типизированное поле field и value - новое значение типизированне any.  
 Реализует динамическое обновление полей.

getOrder() - отвечает за формирование обекта заказа для отправки его на сервер.
Возвращает объект заказа.

clear() - отвечает за очитку заказа.
Сбрасывает все поля.

### Представление

## Класс BasketView

- отвечает за отображене всей корзин с товарами и связь пользовательских событий с DOM.Имплементирует интерфейс View.

Конструктор класса:
constructor(
protected container: HTMLElement,
protected events: IEventEmitter
) - принимает агрументами защищённое поле container, которое является DOM-элементом, в котором храенится элемент корзины, и защищённое поле - объект, реализующий интерфейс IEventEmitter, необходмо для уведомления о событиях.
Конструктор находит дочерние элементы (заголовок товара, цену товара, порядковый номер, кнопку удаления) и настраивает обработчик.

Поля класса:

    protected list: HTMLElement - защищйнное поле list является DOM элементом отображения контейнера списка.
    protected total: HTMLElement - защищйнное поле total является DOM  элементом отображения контейнера общей стоимости товаров.
    protected button: HTMLButtonElement - защищйнное поле button является DOM  элементом отображения контейнера кнопки оформления заказа.

Метод класса:
render(data: { items: { id: string; title: string; price: number }[] })- отвечает за отображение корзины на основе переданных данных.Аргументом принимает перементр data, который является массивом объектов. Обеъект - это отдельный товар.
Подготовка данных (проверяет наличие товаров в корзине, инициализирует переменную для подсчета общей суммы),создание элементов товаров(для каждого товара создает экземпляр BasketItemView, рендерит элемент товара с порядковым номером, добавляет элемент в массив для последующего отображения, суммирует стоимость товаров ), обновление DOM(заменяет содержимое списка товаров новыми элементами,обновляет отображение общей суммы,управляет состоянием кнопки оформления,возвращает корневой элемент для встраивания в DOM).

## Класс BasketItemView

- отвечает за отображение одного товара в корзине и связь пользовательских событий с DOM.Имплементирует интерфейс View.

Конструктор класса:
constructor(
protected container: HTMLElement,
protected events: IEventEmitter
) - принимает агрументами защищённое поле container, которое является DOM-элементом, в котором храенится элемент корзины, и защищённое поле - объект, реализующий интерфейс IEventEmitter, необходмо для уведомления о событиях.
Конструктор находит дочерние элементы (заголовок товара, цену товара, порядковый номер, кнопку удаления) и настраивает обработчик.

Поля класса:

protected title: HTMLSpanElement - защищйнное поле title является DOM элементом отображения названия товара.
protected price: HTMLSpanElement - защищённое поле price является DOM элементом отображения цены.
protected index: HTMLSpanElement - защищённое поле index явлется DOM элементом отображения порядкового номера товара.
protected removeButton: HTMLButtonElement - защищённое поле removeButton является DOM элементом отображения кнопки удаления товара из корзины.
protected id: string | null = null - защищённое поле является идентификатором товара, по умолчанию null.

Метод класса:

render(data): HTMLElement - отвечает за обновление элемента корзины.
Сохраняет ID товара.
Обновляет текстовое содержимое элементов.
Возвращает контейнер для возможного встраивания в DOM.

## Класс CardView

- отвечает за отображение карточки товара и связь пользовательских событий с DOM.Имплементирует интерфейс View.

Конструктор класса:
constructor(
protected container: HTMLElement,
protected events: IEventEmitter
) - принимает агрументами защищённое поле container, которое является DOM-элементом, в котором храенится элемент карточки товара, и защищённое поле - объект, реализующий интерфейс IEventEmitter, необходмо для уведомления о событиях.
Конструктор находит дочерние элементы (заголовок товара, цену товара, категорию товара и изображение).

константа categoryClassMap - сопоставляет названия категорий с CSS-классами для стилизации элемента отображения категории товара.

Поля класса:
protected title: HTMLElement - защищйнное поле title является DOM элементом отображения названия товара.
protected category: HTMLElement - защищённое поле category является DOM элементом отображения категории товара.
protected price: HTMLElement - защищённое поле price является DOM элементом отображения цены.
protected image: HTMLImageElement - защищённое поле image является DOM элементом отображения картинки товара.

Метод класса:
render(product: IProduct) - отвечает за обновление эелемнта карточки товара. В качестве агрумента принимает объект товара типа IProduct.
Устанавливает текст названия, категории и цены, обновляет изображение, обработываеь цену товара(если цена null, отображает "Бесценно", иначе форматирует цену),
Добавляет обработчик клика, генерирующий событие 'product:select',выбирает соответствующий CSS-класс из categoryClassMap.
Возвращает обновленный DOM-элемент карточки.

## Класса PreviewView

- отвечает за отображение модального окна карточки товара и связь пользовательских событий с DOM.

constructor(
protected container: HTMLElement,
protected events: IEventEmitter
) - принимает агрументами защищённое поле container, которое является DOM-элементом, в котором храенится элемент модального окна, и защищённое поле - объект, реализующий интерфейс IEventEmitter, необходмо для уведомления о событиях.
Конструктор находит дочерние элементы (заголовок товара, цену товара, категорию товара, изображение, описание товара, кнопку действия).

Поля класса:

    protected title: HTMLElement -защищйнное поле title является DOM элементом отображения названия товара.
    protected category: HTMLElement - защищённое поле category  является DOM элементом отображения категории товара.
    protected description: HTMLElement - защищённое поле description является DOM элементом описания
    protected price: HTMLElement -защищённое поле price является DOM элементом отображения цены.
    protected image: HTMLImageElement - защищённое поле image  является DOM элементом отображения картинки товара.
    protected button: HTMLButtonElement - защищйнное поле button является DOM  элементом отображения контейнера кнопки добавления товара в корзину.

render(product: IProduct) - отвечает за обновление эелемнта карточки товара. В качестве агрумента принимает объект товара типа IProduct.
Обновление содержимого
Настройка обработчика кнопки(при клике закрывает модальное окно (modal.close()))
Возвращает обновленный DOM-элемент модального окна.

## Класс OrderView

- отвечает за отображение и обработку первого шага оформления заказа(выбор способа оплаты,ввод адреса доставки).
  Клксс отслеживает состояние этих полей, валидирует их и активирует кнопку "Далее", если данные корректны.

Конструктор класса:
constructor(container: HTMLElement, events: IEventEmitter)- аргументами принимает поле container, которое является DOM-элементом, в котором храенится разметка формы, и поле events - объект, реализующий интерфейс IEventEmitter, необходмо для уведомления о событиях.
Внутри конструктора находятся и сохраняются поля ввода : адрес, кнопка перехода к следующему этапу, кнопки выбора способа оплаты.

Поля класса:
private addressInput: HTMLInputElement - приватеное поле addressInput является DOM элементом инпута для ввода адреса.
private buttons: HTMLButtonElement[] - привтное поле buttons является массивом DOM элементов кнопок способа оплаты.
private submitButton: HTMLButtonElement - привтное поле submitButton вляется DOM элементом кнопки "Далее".
private payment: string | null = null - строчка которая содержит текущий выбранный способ оплаты.
private address = '' - строчка которая содержит текущий введённый адрес.

Методы класса:
private updateButtonsState(activeBtn: HTMLButtonElement): void
Добавляет CSS-класс button_alt-active выбранной кнопке оплаты и снимает с остальных.

private checkValidity(): void
Отвечает за проверку выбора способа оплаты и ввода адреса, в зависимости от результата проверки включает или выключает
кнопку "Далее".

render(): HTMLElement
Возвращает контейнер с отрисованной формой. Используется для вставки в DOM.

## Класс ContactsView -

представляет форму ввода контактной информации (email и телефона) в процессе оформления заказа.
Он управляет валидацией полей, отображением ошибок и активацией кнопки отправки формы. При корректном вводе данных эмитит соответствующие события.

Конструктор класса:
constructor(container: HTMLElement, events: IEventEmitter)- аргументами принимает поле container, которое является DOM-элементом, в котором храенится разметка формы, и поле events - объект, реализующий интерфейс IEventEmitter, необходмо для уведомления о событиях.
внутри конструктора находятся и сохраняются элементы формы: email, телефон, кнопка отправки.
Создаются и прикрепляются элементы ошибок (.error-message) под каждым полем.
Назначаются слушатели событий.

Поля класса:
private emailInput: HTMLInputElement - приватное поле emailInput является DOM элементом инпута для ввода email.
private phoneInput: HTMLInputElement - приватное поле phoneInput является DOM элементом инпута для ввода телефона.
private submitButton: HTMLButtonElement - приватное поле является DOM элементом кнопки отправки формы.
private emailError: HTMLElement - приватное поле приватное поле является DOM элементом ввода email.
private phoneError: HTMLElement - приватное поле поле является DOM элементом ввода ввода телефона.
private email = '' - приватное поле email является строкой, содержащее текущее значение.
private phone = '' - приватное поле phone является строкой, содержащее текущее значение.

Методы класса:

render(): HTMLElement
Возвращает контейнер с отрисованной формой. Используется при вставке в DOM.

private checkValidity()
Проверяет оба поля и включает или отключает кнопку отправки формы в зависимости от валидности.

private validatePhone(): boolean
Проверяет правильность номера телефона и возвращает булевое значение в зависимости от валидности.

private validateEmail(): boolean
Проверяет правильность email и возвращает булевое значение в зависимости от валидности.

private createErrorElement(input: HTMLInputElement, defaultMessage: string): HTMLElement
Создаёт или переиспользует элемент для отображения сообщения об ошибке под указанным input.
Если нужного элемента нет — создаёт новый и вставляет его в DOM.

## Класс SuccessView

-отвечает за отображение финального экрана после успешного оформления заказа. Показывает заголовок, сообщение с суммой списанных синапсов и кнопку для завершения оформления (закрытия модального окна).

Конструктор класса:
constructor(container: HTMLElement, events: IEventEmitter)

- принимает аргументами container, который явлется DOM -элементом, в который будет рендериться содержимое компонента, и и защищённое поле events - объект, реализующий интерфейс IEventEmitter, необходмо для уведомления о событиях.
  Находит и сохряняет дочерние элементы ( заголовок окна,описание с итоговой суммой,кнопка "Закрыть").

Поля класса:
private title: HTMLElement - приватное поле title является DOM элементом отображения названия товара.
private description: HTMLElement - приватное поле description является DOM элементом описания товара.
private closeButton: HTMLButtonElement - приватное поле closeButton является DOM элементом кнопки "Закрыть".

Метод класса:
render(data: { total: number }) - о тображает содержимое окна подтверждения заказа.
Устанавливает текст заголовка: "Заказ оформлен".
Устанавливает описание: "Списано N синапсов", где N — переданная сумма.
Возвращает корневой контейнер с отрисованным содержимым.

### Событийно ориентированный подход

При реализации данной проектрой работы используется событийно ориентированный подход.
Ниже описаны все события реализованныйе в проекте.

# 'modal:open'

- генерируется при открытии модального окна в интерфейсе и используется для управления состоянием страницы.

events.on('modal:open', () => {
page.locked = true;
});
В двнном случае запрещает скролл страницы при открытом модальном окне.

# 'modal:close'

- генерируется при закрытии модального окна в интерфейсе и используется для управления состоянием страницы.

events.on('modal:close', () => {
page.locked = false;
});

Данном случае разрешает скролл страницы при закрытии модального окна.

# 'catalog:loaded'

- генерируется при успешной загрузке данных каталога товаров и отвечает за инициализацию отображения товаров на главной странице.
  events.on('catalog:loaded', (data: { items: IProduct[] }) => {
  const cardElements = data.items.map((product) => {
  const card = cloneTemplate(cardCatalogTemplate);
  const cardView = new CardView(card, events);
  return cardView.render(product);
  });

      page.gallery = cardElements;

      //catalogView.render(data);

  });
  В данном случае выводит товары на страницу после получения данных с сервера.

# 'product:receivedFromServer'

- обрабатывает получение детальной информации о товаре с сервера и инициирует показ модального окна с подробной информацией.
  events.on('product:receivedFromServer', (data: { data: IProduct }) => {
  const preview = new PreviewView(cloneTemplate(cardPreviewTemplate), events);

      modal.render({
      	content: preview.render(data.data),
      });

  });

# 'product:select'

- инициирует загрузку информации о продукте по его идентификатору. После получения данных с сервера происходит эмит события product:receivedFromServer с полученными данными продукта.

events.on('product:select', (data: { id: string }) => {
api
.getProductById(data.id)
.then((data) => {
events.emit('product:receivedFromServer', { data });
})
.catch(console.error);
});

# 'basket:change'

- обновляет интерфейс отображения корзины (модальное окно) и счётчик товаров в шапке страницы.

events.on('basket:change', () => {
// Обновляем список в модалке
const items = getBasketItems();

    basketView.render({ items });

    // Обновляем счётчик в шапке
    const count = Array.from(basketModel.items.values()).reduce(
    	(sum, qty) => sum + qty,
    	0
    );
    page.counter = count;

});

# 'ul:basket-add'

- применяется для добавления товара в корзину по его идентификатору. Это событие может использоваться при нажатии на кнопку "Добавить в корзину" в интерфейсе пользователя.
  events.on('ul:basket-add', (event: { id: string }) => {
  basketModel.add(event.id);
  });

# 'basket:open'

- применяется для открытия модального окна с текущим содержимым корзины. При активации события корзина визуализируется и отображается пользователю.

events.on('basket:open', () => {
const items = getBasketItems();

    modal.render({
    	content: basketView.render({ items }),
    });

});

# 'basket:basket-remove'

- применяется для удаления товара из корзины по его идентификатору - при нажании на кнопку "Удалить" рядом с товаром в корзине.

events.on('basket:basket-remove', (event: { id: string }) => {
basketModel.remove(event.id);
});

# 'basket:submit'

- событие инициирует переход в модальное окно оформления заказа. Это событие может использоваться при нажатии на кнопку "Оформить заказ" в интерфейсе пользователя.

events.on('basket:submit', () => {
const orderView = new OrderView(cloneTemplate(orderTemplate), events);
modal.render({
content: orderView.render(),
});
});

# 'order:payment'

- events.on('order:payment', (data) => {
  orderModel.setField(
  'payment',
  (data as { payment: 'online' | 'cash' }).payment
  );
  });

# 'order:address'

- событие используется для установки способа оплаты при оформлении заказа. Оно обновляет соответствующее поле в модели заказа.
  events.on('order:address', (data: { address: string }) => {
  orderModel.setField('address', data.address);
  });

# 'order:email'

- событие используется для установки адреса электронной почты в процессе оформления заказа. Оно обновляет поле email в модели заказа.
  events.on('order:email', (data: { email: string }) => {
  orderModel.setField('email', data.email);
  });

# 'order:phone'

- используется для установки номера телефона клиента в процессе оформления заказа. Обновляет соответствующее поле в модели заказа.
  events.on('order:phone', (data: { phone: string }) => {
  orderModel.setField('phone', data.phone);
  });

# 'order:next'

- инициирует переход к следующему шагу оформления заказа — вводу контактных данных пользователя - выводится форма для ввода телефона и e-mail.
  events.on('order:next', () => {
  const contactsView = new ContactsView(
  cloneTemplate(contactsTemplate),
  events
  );
  modal.render({
  content: contactsView.render(),
  });
  });

# 'order:submit'

- инициирует отправку заказа на сервер. Событие собирает все необходимые данные из модели заказа и корзины, отправляет их через API, и в зависимости от ответа либо завершает процесс, либо выводит ошибку.

events.on('order:submit', () => {
orderModel.setField('items', Array.from(basketModel.items.keys()));
const order = orderModel.getOrder();

    api
    	.createOrder(order)
    	.then((response) => {
    		// Проверяем: это ошибка или успех
    		if ('error' in response) {
    			alert(`Ошибка оформления заказа: ${response.error}`);
    			return;
    		}

    		// Значит, это успешный ответ
    		events.emit('order:complete', { total: response.total });
    	})
    	.catch((err) => {
    		console.error('Сетевая ошибка:', err);
    		alert('Не удалось отправить заказ. Попробуйте ещё раз.');
    	});

});

# 'order:complete'

- уведомляет об успешном оформлении заказа - отображает на экран подтверждение с итоговой суммой заказа.
  events.on('order:complete', (data: { total: number }) => {
  const successView = new SuccessView(cloneTemplate(successTemplate), events);
  modal.render({
  content: successView.render(data),
  });
  });

# 'success:done'

- завершает процесс оформления заказа,вызывается, когда пользователь закрывает модальное окно успешного оформления заказа.

events.on('success:done', () => {
basketModel.clear();
orderModel.clear();
modal.close();
});

## Пример взаимодействия "Добавление товара в корзину"

1. Пользователь кликает на кнопку "Добавить в корзину" в модальном окне карточки товара
   В классе PreviewView (модальное окно товара) генерируется событие: 'basket:add' с id конкретного товара, который пользователь хочет добавить.
   // PreviewView.ts
   this.button.addEventListener('click', () => {
   modal.close();
   this.events.emit('basket:add', { id: product.id }); // - генерируемое событие
   });
2. Обработка события
   метод on dызывает метод модели add() с полученным id конкретного товара
   // index.ts
   events.on('ul:basket-add', (event: { id: string }) => {
   basketModel.add(event.id); // - вызов метода add().
   });
3. Модель данных BasketModel изменяет данные и генерирует событие
   в методе add класса BasketModel происходит изменение поля item - увечличение сёчтика
   генерируется событе 'basket:change'

// BasketModel.ts
add(id: string): void {
this.items.set(id, (this.items.get(id) ?? 0) + 1);
this.\_changed();
}

protected \_changed() {
this.events.emit('basket:change', {
items: Array.from(this.items.keys()),
});
}

4. Запрос данных и обновление

// index.ts
events.on('basket:change', () => {
// Обновляем список в модальном окне корзины
const items = getBasketItems(); //- получаем данные

    basketView.render({ items }); //- обновляем корзину

    // Обновляем счётчик в шапке
    const count = Array.from(basketModel.items.values()).reduce(
    	(sum, qty) => sum + qty,
    	0
    );
    page.counter = count; // -  обновляем счетчик

})

5.  Обновление Veiw корзины с товарами
    Метод render класса BasketView возвращает обновлённый элемент корзины (описание метода см. выше)
    // Basket.ts
    render(data: { items: { id: string; title: string; price: number }[] }) {
    const elements: HTMLElement[] = [];
    let total = 0;

        	// Проверяем, есть ли товары в корзине
        	const hasItems = data.items.length > 0;

        	data.items.forEach((item, i) => {
        		const template = cloneTemplate(cardBasketTemplate);

        		const itemView = new BasketItemView(template, this.events);
        		const el = itemView.render({ ...item, index: i + 1 });

        		elements.push(el);
        		total += item.price;
        	});

        	this.list.replaceChildren(...elements);
        	this.total.textContent = `${total} синапсов`;

        	// Устанавливаем состояние кнопки в зависимости от наличия товаров
        	this.button.disabled = !hasItems;

        	return this.container;
        }
